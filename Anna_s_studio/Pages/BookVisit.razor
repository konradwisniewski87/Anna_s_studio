@page "/book"

@inject VisitBookingService BookingService

<h3>Umów wizytę</h3>
<div>
    <label>Wybierz datę:</label>
    <InputDate @bind-Value="SelectedDate" />
</div>
<div>
    <label>Wybierz godzinę:</label>
    <select @bind="SelectedHour">
        @for (int hour = 9; hour < 15; hour++)
        {
            <option value="@hour">@hour:00 - @(hour + 1):00</option>
        }
    </select>
</div>
<button @onclick="GenerateBookingLinks" class="btn btn-primary mt-2">Rezerwuj wizytę</button>

@if (!string.IsNullOrEmpty(GoogleCalendarLink))
{
    <div class="mt-3">
        <a href="@GoogleCalendarLink" target="_blank" class="btn btn-outline-success">Dodaj do swojego Google Kalendarza</a>
    </div>
}
@if (!string.IsNullOrEmpty(ExternalCalendarLink))
{
    <div class="mt-2">
        <a href="@ExternalCalendarLink" target="_blank" class="btn btn-outline-secondary">Dodaj do innego kalendarza (ICS)</a>
    </div>
}

@code {
    private DateTime SelectedDate { get; set; } = DateTime.Today;
    private int SelectedHour { get; set; } = 9;
    private string GoogleCalendarLink { get; set; }
    private string ExternalCalendarLink { get; set; }

    private void GenerateBookingLinks()
    {
        var start = SelectedDate.Date.AddHours(SelectedHour);
        var end = start.AddHours(1);

        GoogleCalendarLink = BookingService.GetGoogleCalendarUrl(start, end, "Wizyta w Anna's Studio", "Studio Urody", "Umówiona wizyta");
        ExternalCalendarLink = BookingService.GetIcsCalendarUrl(start, end, "Wizyta w Anna's Studio", "Studio Urody", "Umówiona wizyta");
    }
}
